{# Extend base template for consistent layout #}
{% extends 'newyear/base.html' %}

{# Load internationalization support for multiple languages #}
{% load i18n %}

{# Set page title #}
{% block title %}New Year{% endblock %}

{# Set specific background class for New Year theme #}
{% block body_class %}newyear-bg{% endblock %}

{# Main content block #}
{% block content %}
    <h1 class="holiday-title">
        <span>{% trans "Is it New Year?" %}</span>
        <span dir="rtl" lang="ar" class="holiday-title-ar">
            {% language 'ar' %}{% trans "Is it New Year?" %}{% endlanguage %}
        </span>
    </h1>

    {# Conditional content based on whether it's New Year or not #}
    {% if newyear %}
        <h2>YES!</h2>
        {# Celebration message with festive emojis #}
        <div id="celebrate-message" style="margin:1.5em 0;font-size:1.3rem;color:#ffe066;text-align:center;">
            ðŸŽ‰ Happy New Year! ðŸŽ‰
        </div>
        <script>
            /**
             * Creates a festive confetti animation effect
             * Generates multiple colored particles that fall from top to bottom of the screen
             * with rotation animation for a celebratory effect
             */
            function confetti() {
                // Create 120 confetti particles
                for (let i = 0; i < 120; i++) {
                    // Create a new confetti element
                    let conf = document.createElement('div');
                    
                    // Set initial styling for the confetti particle
                    conf.style.position = 'fixed';      // Fixed position for viewport-relative placement
                    conf.style.left = Math.random() * 100 + 'vw';  // Random horizontal position
                    conf.style.top = '-2vh';            // Start above viewport
                    conf.style.width = '8px';           // Confetti width
                    conf.style.height = '16px';         // Confetti height
                    
                    // Generate random HSL color with high saturation and lightness
                    conf.style.background = `hsl(${Math.random()*360},90%,70%)`;
                    conf.style.opacity = 0.8;           // Slight transparency
                    conf.style.borderRadius = '2px';    // Rounded corners
                    conf.style.zIndex = 9999;          // Ensure confetti appears above other elements
                    
                    // Set smooth transition for falling and rotation animations
                    conf.style.transition = 'top 2.2s cubic-bezier(.23,1.02,.64,1), transform 2.2s';
                    
                    // Add confetti to the page
                    document.body.appendChild(conf);
                    
                    // Start falling animation after a tiny delay
                    setTimeout(() => {
                        conf.style.top = '100vh';      // Move to bottom of viewport
                        conf.style.transform = `rotate(${Math.random()*360}deg)`; // Random rotation
                    }, 10);
                    
                    // Remove confetti element after animation (2.3 seconds)
                    setTimeout(() => conf.remove(), 2300);
                }
            }
            // Execute the confetti animation
            confetti();
        </script>
    {% else %}
        {# Display when it's not New Year #}
        <h2>NO.</h2>
    {% endif %}

    {# Display next New Year date #}
    <div class="newyear-date" style="margin:1em 0 0.5em 0;text-align:center;color:#aee6fa;">
        New Year {{ event_date.year }} is on: {{ event_date|date:'F j, Y' }}
    </div>

    {# Countdown display #}
    <div class="days-left">
        {% if days_left == 0 %}
            {# Show when it's New Year's Day #}
            <strong>It's New Year's Day!</strong>
        {% else %}
            {# Show countdown for other days #}
            <span>{{ days_left }} day{{ days_left|pluralize }} left until New Year.</span>
        {% endif %}
    </div>

    {# Visual progress bar container #}
    <div id="progress-bar-container" style="margin:1.2em auto 0 auto;max-width:420px;width:90%;background:rgba(30,34,54,0.7);border-radius:1em;height:18px;box-shadow:0 1px 6px rgba(0,201,255,0.08);">
        {# Animated progress bar that updates via JavaScript #}
        <div id="progress-bar" style="height:100%;background:linear-gradient(90deg,#7fd7ff,#aee6fa);border-radius:1em 0 0 1em;width:0%;transition:width 1s;"></div>
    </div>
    <script>
        /**
         * Progress bar calculation for New Year countdown
         * Calculates how much of the current year has elapsed and displays it as a progress bar
         * The progress bar shows the percentage of time passed from January 1st to December 31st
         */
        (function() {
            // Get current date for calculations
            const now = new Date();
            
            // Set start date to January 1st of current year
            // Note: Month is 0-based in JavaScript (0 = January)
            const start = new Date(now.getFullYear(), 0, 1);
            
            // Set end date to January 1st of next year
            const end = new Date(now.getFullYear() + 1, 0, 1);
            
            // Calculate total days in the year
            // Converting milliseconds to days: ms / (1000ms * 60s * 60m * 24h)
            const total = (end - start) / (1000 * 60 * 60 * 24);
            
            // Calculate number of days elapsed since start of year
            const elapsed = (now - start) / (1000 * 60 * 60 * 24);
            
            // Calculate percentage of year completed (clamped between 0-100%)
            const percent = Math.min(100, Math.max(0, (elapsed / total) * 100));
            
            // Update the progress bar width in the DOM
            document.getElementById('progress-bar').style.width = percent + '%';
        })();
    </script>
    {% if fact %}
        <div style="margin:1.2em 0 0 0;padding:0.8em 1.2em;background:rgba(30,34,54,0.85);color:#aee6fa;border-radius:1em;font-size:1.05rem;max-width:420px;margin-left:auto;margin-right:auto;">
            <span style="font-size:1.2em;">ðŸ’¡</span> {{ fact }}
        </div>
    {% endif %}
{% endblock %}
