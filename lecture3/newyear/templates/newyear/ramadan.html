{% extends 'newyear/base.html' %}
{% load i18n %}
{% block title %}Ramadan{% endblock %}
{% block body_class %}ramadan-bg{% endblock %}
{% block content %}
    <h1 class="holiday-title">
        <span>{% trans "Is it Ramadan?" %}</span>
        <span dir="rtl" lang="ar" class="holiday-title-ar">{% language 'ar' %}{% trans "Is it Ramadan?" %}{% endlanguage %}</span>
    </h1>
    {% if is_ramadan %}
        <h2>{% trans "YES!" %}</h2>
        <div class="holiday-message">ðŸ•Œ {% trans "Ramadan Mubarak!" %} ðŸ•Œ</div>
    {% else %}
        <h2>{% trans "NO." %}</h2>
    {% endif %}
    <div class="holiday-dates">
        Ramadan {{ event_start.year }} starts on: {{ event_start|date:'F j, Y' }}<br>
        and ends on: {{ event_end|date:'F j, Y' }}
    </div>
    <div class="days-left">
        <span>{{ days_left }} day{{ days_left|pluralize }} left until Ramadan.</span>
    </div>
    <div id="progress-bar-container" style="margin:1.2em auto 0 auto;max-width:420px;width:90%;background:rgba(30,34,54,0.7);border-radius:1em;height:18px;box-shadow:0 1px 6px rgba(0,201,255,0.08);">
        <div id="progress-bar" style="height:100%;background:linear-gradient(90deg,#7fd7ff,#aee6fa);border-radius:1em 0 0 1em;width:0%;transition:width 1s;"></div>
    </div>
    <script>
        /**
         * Progress bar calculation for Ramadan
         * This self-executing function handles three different scenarios:
         * 1. Before Ramadan: Shows progress from start of year to Ramadan start
         * 2. During Ramadan: Shows progress through the month of Ramadan
         * 3. After Ramadan: Shows full progress for the year
         */
        (function() {
            // Get current date for all calculations
            const now = new Date();

            // Define Ramadan dates for the current year
            // Note: Months are 0-based in JavaScript (0=Jan, 1=Feb, etc.)
            const ramadanStart = new Date(now.getFullYear(), 1, 17); // February 17
            const ramadanEnd = new Date(now.getFullYear(), 2, 18);   // March 18

            // Variables to store the progress bar calculation dates
            let start, end;

            // Determine which date range to use based on current time
            if (now < ramadanStart) {
                // Case 1: Before Ramadan - count down from start of year
                start = new Date(now.getFullYear(), 0, 1);  // January 1
                end = ramadanStart;
            } else if (now >= ramadanStart && now <= ramadanEnd) {
                // Case 2: During Ramadan - show progress through the month
                start = ramadanStart;
                end = ramadanEnd;
            } else {
                // Case 3: After Ramadan - show full progress
                start = new Date(now.getFullYear(), 0, 1);
                end = ramadanStart;
            }

            // Calculate total days in the selected period
            // Converting milliseconds to days: ms / (1000ms * 60s * 60m * 24h)
            const total = (end - start) / (1000 * 60 * 60 * 24);
            
            // Calculate days elapsed since start date
            const elapsed = (now - start) / (1000 * 60 * 60 * 24);
            
            // Calculate percentage and clamp between 0-100%
            const percent = Math.min(100, Math.max(0, (elapsed / total) * 100));
            
            // Update the progress bar width in the DOM
            document.getElementById('progress-bar').style.width = percent + '%';
        })();
    </script>
    {% if fact %}
        <div style="margin:1.2em 0 0 0;padding:0.8em 1.2em;background:rgba(30,34,54,0.85);color:#aee6fa;border-radius:1em;font-size:1.05rem;max-width:420px;margin-left:auto;margin-right:auto;">
            <span style="font-size:1.2em;">ðŸ’¡</span> {{ fact }}
        </div>
    {% endif %}
{% endblock %}
\\