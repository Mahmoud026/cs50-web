{% extends 'newyear/base.html' %}
{% load i18n %}
{% block title %}Eid{% endblock %}
{% block body_class %}{% if eid_type == 'fitr' %}eid-fitr-bg{% elif eid_type == 'adha' %}eid-adha-bg{% else %}eid-bg{% endif %}{% endblock %}
{% block content %}
    <h1 class="holiday-title">
        {% if eid_type == "fitr" %}
            <span>{% trans "Is it Eid al-Fitr?" %}</span>
            <span dir="rtl" lang="ar" class="holiday-title-ar">{% language 'ar' %}{% trans "Is it Eid al-Fitr?" %}{% endlanguage %}</span>
        {% elif eid_type == "adha" %}
            <span>{% trans "Is it Eid al-Adha?" %}</span>
            <span dir="rtl" lang="ar" class="holiday-title-ar">{% language 'ar' %}{% trans "Is it Eid al-Adha?" %}{% endlanguage %}</span>
        {% else %}
            <span>{% trans "Is it Eid?" %}</span>
            <span dir="rtl" lang="ar" class="holiday-title-ar">{% language 'ar' %}{% trans "Is it Eid?" %}{% endlanguage %}</span>
        {% endif %}
    </h1>
    {% if is_eid %}
        <h2>{% trans "YES!" %}</h2>
        <div class="holiday-message">
            {% if eid_type == 'fitr' %}ðŸŒ™ Eid Mubarak! ðŸŒ™{% elif eid_type == 'adha' %}ðŸ•‹ Eid Mubarak! ðŸ•‹{% else %}ðŸŽ‰ Eid Mubarak! ðŸŽ‰{% endif %}
        </div>
        <script>
            // Simple confetti animation
            function confetti() {
                for (let i = 0; i < 120; i++) {
                    let conf = document.createElement('div');
                    conf.style.position = 'fixed';
                    conf.style.left = Math.random() * 100 + 'vw';
                    conf.style.top = '-2vh';
                    conf.style.width = '8px';
                    conf.style.height = '16px';
                    conf.style.background = `hsl(${Math.random()*360},90%,70%)`;
                    conf.style.opacity = 0.8;
                    conf.style.borderRadius = '2px';
                    conf.style.zIndex = 9999;
                    conf.style.transition = 'top 2.2s cubic-bezier(.23,1.02,.64,1), transform 2.2s';
                    document.body.appendChild(conf);
                    setTimeout(() => {
                        conf.style.top = '100vh';
                        conf.style.transform = `rotate(${Math.random()*360}deg)`;
                    }, 10);
                    setTimeout(() => conf.remove(), 2300);
                }
            }
            confetti();
        </script>
    {% else %}
        <h2>NO.</h2>
    {% endif %}
    <div class="eid-dates" style="margin:1em 0 0.5em 0;text-align:center;color:#aee6fa;">
        {% if eid_type == 'fitr' %}
            Eid al-Fitr 2026 is on: {{ event_date|date:'F j, Y' }}
        {% elif eid_type == 'adha' %}
            Eid al-Adha 2026 starts on: {{ event_start|date:'F j, Y' }}<br>
            and ends on: {{ event_end|date:'F j, Y' }}
        {% endif %}
    </div>
    <div class="days-left">
        {% if days_left == 0 %}
            <strong>It's Eid!</strong>
        {% else %}
            <span>{{ days_left }} day{{ days_left|pluralize }} left until Eid.</span>
        {% endif %}
    </div>
    <div id="progress-bar-container" style="margin:1.2em auto 0 auto;max-width:420px;width:90%;background:rgba(30,34,54,0.7);border-radius:1em;height:18px;box-shadow:0 1px 6px rgba(0,201,255,0.08);">
        <div id="progress-bar" style="height:100%;background:linear-gradient(90deg,#7fd7ff,#aee6fa);border-radius:1em 0 0 1em;width:0%;transition:width 1s;"></div>
    </div>
    <script>
        /**
         * Progress bar calculation for Eid countdown
         * This self-executing function calculates and updates the progress bar
         * showing the progress towards the next Eid celebration.
         */
        (function() {
            // Get current date for calculations
            const now = new Date();
            let start, end;

            // Set start and end dates based on Eid type
            if ("{{ eid_type }}" === "fitr") {
                // For Eid al-Fitr: Start from beginning of year to March 20, 2026
                start = new Date(now.getFullYear(), 0, 1);
                end = new Date(2026, 2, 20); // March 20, 2026
            } else if ("{{ eid_type }}" === "adha") {
                // For Eid al-Adha: Start from beginning of year to May 26, 2026
                start = new Date(now.getFullYear(), 0, 1);
                end = new Date(2026, 4, 26); // May 26, 2026
            } else {
                // Default case: Calculate for current year
                start = new Date(now.getFullYear(), 0, 1);
                end = new Date(now.getFullYear(), 11, 31);
            }

            // Calculate total days between start and end dates
            const total = (end - start) / (1000 * 60 * 60 * 24);
            
            // Calculate days elapsed since start date
            const elapsed = (now - start) / (1000 * 60 * 60 * 24);
            
            // Calculate percentage completion (clamped between 0 and 100)
            const percent = Math.min(100, Math.max(0, (elapsed / total) * 100));
            
            // Update the progress bar width with the calculated percentage
            document.getElementById('progress-bar').style.width = percent + '%';
        })();
    </script>
    {% if fact %}
        <div style="margin:1.2em 0 0 0;padding:0.8em 1.2em;background:rgba(30,34,54,0.85);color:#aee6fa;border-radius:1em;font-size:1.05rem;max-width:420px;margin-left:auto;margin-right:auto;">
            <span style="font-size:1.2em;">ðŸ’¡</span> {{ fact }}
        </div>
    {% endif %}
{% endblock %}
